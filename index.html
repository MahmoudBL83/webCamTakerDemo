<!DOCTYPE html>
<html lang="en">
<head>
    <style>
        *{
    margin:0;
    padding: 0;
}

body{
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    flex-direction: column;
    gap:15px;
}

video{
    box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
    width:50vw;
    height: 50vh;
}

#previewPhoto{
    position: absolute;
    top:50%;
    right: 50%;
    transform: translate(50%,-50%);
    display: flex;
    flex-direction: column;
    transition: 0.6s;
}

.but{
    align-items: center;
    appearance: none;
    background: radial-gradient(100% 100% at 100% 0, #09917c 0, #09917c 100%);
    border: 0;
    border-radius: 6px;
    box-shadow: rgb(45 35 66 / 40%) 0 2px 4px, rgb(45 35 66 / 30%) 0 7px 13px -3px, rgb(58 65 111 / 50%) 0 -3px 0 inset;
    box-sizing: border-box;
    color: #fff;
    cursor: pointer;
    display: inline-flex;
    height: 48px;
    justify-content: center;
    line-height: 1;
    list-style: none;
    overflow: hidden;
    padding-left: 16px;
    padding-right: 16px;
    position: relative;
    text-align: left;
    text-decoration: none;
    transition: box-shadow .15s,transform .15s;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
    white-space: nowrap;
    will-change: box-shadow,transform;
    font-size: 18px;
}

#photosCol{
    position: absolute;
    height: 100%;
    right:40px;
    top:40px;
    display: flex;
    flex-direction: column;
    gap:10px;
}

#photosCol>div{
    display: flex;
    flex-direction: column;
}

#photosCol>div>div{
   width:100%;
}

#buttonsCol{
    position: absolute;
    height: 100%;
    left:50px;
    top:50%;
    display: flex;
    flex-direction: column;
}

.hideCam{
    opacity: 0;
    z-index:-1000;
}
    </style>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./index.css">
</head>
<body>
    <div id="buttonsCol">
        <div class="but" id="start-camera1">personal photo</div>
        <div class="but" id="start-camera2">scan national id (FRONT)</div>
        <div class="but" id="start-camera3">scan national id (BACK)</div>
    </div>
    <div id="previewPhoto" class="hideCam">
        <video id="video" autoplay></video>
        <div class="but" id="click-photo">إلتقط الصورة</div>
    </div>
    <div id="photosCol">
        <div>
            <div class="but">صورة شخصية</div>
            <img id="personalPhoto" src="">
        </div>
        <div>
            <div class="but">صورة بطاقة أمامية</div>
            <img id="nationalIDFront" src="">
        </div>
        <div>
            <div class="but">صورة بطاقة خلفية</div>
            <img id="nationalIDBack" src="">
        </div>
    </div>
    <canvas id="canvas" width="320" height="240" style="display:none;"></canvas>
</body>
<script>
    
    //Buttons of start cam
    let startCam1 = document.querySelector("#start-camera1");
    let startCam2 = document.querySelector("#start-camera2");
    let startCam3 = document.querySelector("#start-camera3");

    let video = document.querySelector("#video");
    let takePhoto = document.querySelector("#click-photo");
    let canvas = document.querySelector("#canvas");

    //SETTING EVENT HANDLER FOR EACH BUTTON TO START THE CAM
    [startCam1,startCam2,startCam3].forEach(e=>{
        e.addEventListener('click', async function() {
            takePhoto.setAttribute('photoType',e.id)
            adjustPhoto()
        });
    })
    
    //SETTING EVENT HANDLER FOR TAKING THE PHOTO
    takePhoto.addEventListener('click',function () {
        document.querySelector('#previewPhoto').classList.add('hideCam')
        canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);
        let image_data_url = canvas.toDataURL('image/jpeg');
        let photoTypesMap = new Map([
            ['start-camera1','#personalPhoto'],
            ['start-camera2','#nationalIDFront'],
            ['start-camera3','#nationalIDBack'],
        ])
        //SET THE IMAGE IN THE PROPER SIDE
        document.querySelector(photoTypesMap.get(takePhoto.getAttribute('photoType'))).src = image_data_url;
        console.log(dataURLtoFile(image_data_url,'imgNew.jpg'))
        
    });

    async function adjustPhoto(){
        document.querySelector('#previewPhoto').classList.remove('hideCam')
        await navigator.mediaDevices.getUserMedia({ video: {facingMode:'user'}, audio: false })
        .then((stream)=>{
            video.srcObject = stream;
        })
        .catch((err)=>{
            alert('the devices are not connected')
        })
    }

    function dataURLtoFile(dataurl, filename) {
        
        var arr = dataurl.split(','),
            mime = arr[0].match(/:(.*?);/)[1],
            bstr = atob(arr[1]), 
            n = bstr.length, 
            u8arr = new Uint8Array(n);
            
        while(n--){
            u8arr[n] = bstr.charCodeAt(n);
        }
        
        return new File([u8arr], filename, {type:mime});
        }
</script>
</html>
